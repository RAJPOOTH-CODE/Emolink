<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmoLink - Emotional Message Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&family=Dancing+Script:wght@700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .title-font {
            font-family: 'Playfair Display', serif;
        }

        .handwriting {
            font-family: 'Dancing Script', cursive;
        }

        /* Countdown Animation */
        .countdown-number {
            animation: pulse-scale 1s ease-in-out;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
        }

        @keyframes pulse-scale {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            50% {
                transform: scale(1.2);
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Card Pop-up Animation */
        .card-reveal {
            animation: card-pop 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes card-pop {
            0% {
                transform: scale(0) rotate(-10deg);
                opacity: 0;
            }

            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* Floating hearts */
        .heart {
            position: fixed;
            pointer-events: none;
            animation: float-up 4s ease-in forwards;
            opacity: 0;
        }

        @keyframes float-up {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 1;
            }

            100% {
                transform: translateY(-100vh) scale(1.5);
                opacity: 0;
            }
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Template Previews */
        .template-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .template-card.selected {
            ring: 4px solid #fbbf24;
            transform: scale(1.05);
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>

<body class="text-white overflow-x-hidden">

    <!-- CREATOR VIEW -->
    <div id="creatorView" class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="text-center mb-12">
            <h1
                class="title-font text-5xl md:text-6xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 to-pink-300">
                EmoLink
            </h1>
            <p class="text-xl text-gray-200">Create magical emotional moments with countdown reveals</p>
        </header>

        <div class="glass rounded-3xl p-8 shadow-2xl">
            <!-- Step 1: Choose Template -->
            <div class="mb-10">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <span
                        class="bg-yellow-400 text-purple-900 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold">1</span>
                    Choose Your Moment
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Birthday Template -->
                    <div class="template-card bg-gradient-to-br from-pink-500 to-rose-600 rounded-2xl p-6 text-center"
                        onclick="selectTemplate('birthday', this)">
                        <div class="text-6xl mb-4">üéÇ</div>
                        <h3 class="font-bold text-xl mb-2">Birthday</h3>
                        <p class="text-sm opacity-90">Celebrate their special day with joy</p>
                    </div>

                    <!-- Proposal Template -->
                    <div class="template-card bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl p-6 text-center"
                        onclick="selectTemplate('proposal', this)">
                        <div class="text-6xl mb-4">üíç</div>
                        <h3 class="font-bold text-xl mb-2">Proposal</h3>
                        <p class="text-sm opacity-90">Ask the big question beautifully</p>
                    </div>

                    <!-- Apology Template -->
                    <div class="template-card bg-gradient-to-br from-blue-500 to-cyan-600 rounded-2xl p-6 text-center"
                        onclick="selectTemplate('apology', this)">
                        <div class="text-6xl mb-4">üíô</div>
                        <h3 class="font-bold text-xl mb-2">Apology</h3>
                        <p class="text-sm opacity-90">Say sorry from the heart</p>
                    </div>
                </div>
            </div>

            <!-- Step 2: Customize Content -->
            <div class="mb-10">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <span
                        class="bg-yellow-400 text-purple-900 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold">2</span>
                    Personalize Your Message
                </h2>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Receiver's Name</label>
                        <input type="text" id="receiverName" placeholder="e.g., Sarah"
                            class="w-full px-4 py-3 rounded-xl bg-white/20 border border-white/30 placeholder-white/50 text-white focus:outline-none focus:ring-2 focus:ring-yellow-400">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Your Message</label>
                        <textarea id="customMessage" rows="4" placeholder="Write your heartfelt message here..."
                            class="w-full px-4 py-3 rounded-xl bg-white/20 border border-white/30 placeholder-white/50 text-white focus:outline-none focus:ring-2 focus:ring-yellow-400 resize-none"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Your Name (Sender)</label>
                        <input type="text" id="senderName" placeholder="e.g., John"
                            class="w-full px-4 py-3 rounded-xl bg-white/20 border border-white/30 placeholder-white/50 text-white focus:outline-none focus:ring-2 focus:ring-yellow-400">
                    </div>
                </div>
            </div>

            <!-- Step 3: Generate Link -->
            <div class="text-center">
                <button onclick="generateLink()"
                    class="bg-gradient-to-r from-yellow-400 to-orange-500 text-purple-900 font-bold py-4 px-12 rounded-full text-lg hover:scale-105 transition-transform shadow-lg hover:shadow-xl">
                    ‚ú® Generate Magic Link ‚ú®
                </button>
            </div>

            <!-- Generated Link Display -->
            <div id="linkDisplay" class="hidden mt-8 p-6 bg-white/10 rounded-2xl border border-white/20">
                <p class="text-sm mb-4 text-gray-300">Share this link with your special someone:</p>
                <div class="flex flex-col gap-4">
                    <div class="flex gap-2">
                        <input type="text" id="generatedLink" readonly
                            class="flex-1 px-4 py-3 rounded-lg bg-black/30 text-white font-mono text-sm">
                        <button onclick="copyLink()"
                            class="bg-white/20 hover:bg-white/30 px-6 py-3 rounded-lg font-medium transition-colors">
                            Copy
                        </button>
                    </div>
                    <button onclick="shareOnWhatsApp()"
                        class="bg-[#25D366] text-white font-bold py-3 px-6 rounded-xl flex items-center justify-center gap-2 hover:scale-105 transition-transform shadow-lg">
                        <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24">
                            <path
                                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
                        </svg>
                        Share via WhatsApp
                    </button>
                    <div id="localWarning"
                        class="hidden flex items-center gap-2 p-3 bg-yellow-400/20 rounded-xl border border-yellow-400/50">
                        <span class="text-xl">‚ö†Ô∏è</span>
                        <p class="text-xs text-yellow-200">You are on a local file. This link may only work on your
                            computer. Host it online for others to see!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RECEIVER VIEW (Hidden by default) -->
    <div id="receiverView"
        class="hidden min-h-screen flex flex-col items-center justify-center relative overflow-hidden">
        <!-- Background Elements -->
        <div class="absolute inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900"></div>
        <div id="particles" class="absolute inset-0 pointer-events-none"></div>

        <!-- Countdown Screen -->
        <div id="countdownScreen" class="relative z-10 text-center">
            <p class="text-2xl md:text-3xl mb-8 text-gray-300 animate-pulse">Get ready for something special...</p>
            <div id="countdownNumber" class="text-9xl md:text-[12rem] font-bold text-white countdown-number">10</div>
        </div>

        <!-- Card Display (Hidden initially) -->
        <div id="cardDisplay" class="hidden relative z-10 max-w-2xl w-full mx-4">
            <div id="cardContent" class="card-reveal bg-white rounded-3xl shadow-2xl overflow-hidden">
                <!-- Dynamic content inserted here -->
            </div>

            <div class="text-center mt-8">
                <button onclick="replayExperience()"
                    class="bg-white/20 hover:bg-white/30 text-white px-8 py-3 rounded-full backdrop-blur-sm transition-all">
                    ‚Üª Watch Again
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedTemplate = null;
        let audioContext = null;
        let currentOscillator = null;

        // Template configurations
        const templates = {
            birthday: {
                bg: 'from-pink-400 via-red-400 to-yellow-400',
                emoji: 'üéÇ',
                title: 'Happy Birthday!',
                music: 'happy',
                color: 'text-pink-600'
            },
            proposal: {
                bg: 'from-purple-400 via-pink-400 to-red-400',
                emoji: 'üíç',
                title: 'Will You?',
                music: 'romantic',
                color: 'text-purple-600'
            },
            apology: {
                bg: 'from-blue-400 via-indigo-400 to-purple-400',
                emoji: 'üíô',
                title: 'I\'m Sorry',
                music: 'soft',
                color: 'text-blue-600'
            }
        };

        function selectTemplate(type, element) {
            selectedTemplate = type;
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        function generateLink() {
            if (!selectedTemplate) {
                alert('Please select a template first!');
                return;
            }

            const receiver = document.getElementById('receiverName').value || 'Someone Special';
            const message = document.getElementById('customMessage').value || 'You are amazing!';
            const sender = document.getElementById('senderName').value || 'Secret Admirer';

            const data = {
                template: selectedTemplate,
                receiver: receiver,
                message: message,
                sender: sender,
                timestamp: Date.now()
            };

            // Unicode-safe Base64 encoding
            const jsonString = JSON.stringify(data);
            const uint8Array = new TextEncoder().encode(jsonString);
            const binString = Array.from(uint8Array, (byte) => String.fromCodePoint(byte)).join("");
            const encoded = btoa(binString);

            const url = `${window.location.origin}${window.location.pathname}?card=${encoded}`;

            document.getElementById('generatedLink').value = url;
            document.getElementById('linkDisplay').classList.remove('hidden');

            // Show warning if local
            if (window.location.protocol === 'file:' || window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                document.getElementById('localWarning').classList.remove('hidden');
            }
        }

        function shareOnWhatsApp() {
            const url = document.getElementById('generatedLink').value;
            const receiver = document.getElementById('receiverName').value || 'Someone Special';
            const text = `Hey ${receiver}! I've created something special for you. Follow the link to see it: ${url}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        function copyLink() {
            const linkInput = document.getElementById('generatedLink');
            linkInput.select();
            document.execCommand('copy');

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = originalText, 2000);
        }

        // Check if viewing a card
        window.onload = function () {
            const params = new URLSearchParams(window.location.search);
            const cardData = params.get('card');

            if (cardData) {
                try {
                    // Unicode-safe Base64 decoding
                    const binString = atob(cardData);
                    const uint8Array = Uint8Array.from(binString, (m) => m.codePointAt(0));
                    const jsonString = new TextDecoder().decode(uint8Array);
                    const data = JSON.parse(jsonString);
                    showReceiverView(data);
                } catch (e) {
                    console.error('Invalid card data', e);
                    alert("Oops! This link seems to be broken. Maybe try generating a new one?");
                }
            }
        };

        function showReceiverView(data) {
            document.getElementById('creatorView').classList.add('hidden');
            document.getElementById('receiverView').classList.remove('hidden');

            // Start countdown
            let count = 10;
            const countdownEl = document.getElementById('countdownNumber');

            // Play tick sound for each number
            const interval = setInterval(() => {
                playTone(800, 0.1, 'square');
                countdownEl.textContent = count;
                countdownEl.style.animation = 'none';
                setTimeout(() => countdownEl.style.animation = '', 10);

                count--;

                if (count < 0) {
                    clearInterval(interval);
                    revealCard(data);
                }
            }, 1000);
        }

        function revealCard(data) {
            const template = templates[data.template];

            // Hide countdown, show card
            document.getElementById('countdownScreen').classList.add('hidden');
            document.getElementById('cardDisplay').classList.remove('hidden');

            // Build card HTML
            const cardHTML = `
                <div class="bg-gradient-to-br ${template.bg} p-1">
                    <div class="bg-white rounded-3xl p-8 md:p-12 text-center">
                        <div class="text-8xl mb-6 animate-bounce">${template.emoji}</div>
                        <h1 class="handwriting text-5xl md:text-6xl ${template.color} mb-6">${template.title}</h1>
                        <div class="w-24 h-1 bg-gradient-to-r from-transparent via-gray-400 to-transparent mx-auto mb-6"></div>
                        <p class="text-2xl md:text-3xl text-gray-700 mb-4 font-light">Dear ${data.receiver},</p>
                        <p class="text-xl md:text-2xl text-gray-600 mb-8 leading-relaxed handwriting text-3xl">${data.message}</p>
                        <div class="mt-8 pt-6 border-t border-gray-200">
                            <p class="text-gray-500 text-sm uppercase tracking-widest mb-2">With love,</p>
                            <p class="text-2xl font-bold ${template.color}">${data.sender}</p>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('cardContent').innerHTML = cardHTML;

            // Play special music
            playBackgroundMusic(template.music);

            // Trigger effects
            createConfetti();
            if (data.template === 'birthday' || data.template === 'proposal') {
                createHearts();
            }
        }

        function playTone(frequency, duration, type = 'sine') {
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = type;

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playBackgroundMusic(style) {
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();

            const now = audioContext.currentTime;

            if (style === 'happy') {
                // Happy birthday-ish melody
                const notes = [264, 264, 297, 264, 352, 330, 264, 264, 297, 264, 396, 352];
                notes.forEach((freq, i) => {
                    playTone(freq, 0.4, 'sine');
                    setTimeout(() => { }, i * 400);
                });
            } else if (style === 'romantic') {
                // Romantic arpeggio
                const notes = [330, 392, 494, 392, 330, 392, 494, 523];
                notes.forEach((freq, i) => {
                    setTimeout(() => playTone(freq, 0.8, 'triangle'), i * 600);
                });
            } else {
                // Soft apology chords
                const notes = [262, 330, 392, 330, 262, 196];
                notes.forEach((freq, i) => {
                    setTimeout(() => playTone(freq, 1.2, 'sine'), i * 800);
                });
            }
        }

        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 50);
            }
        }

        function createHearts() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart text-4xl';
                    heart.textContent = '‚ù§Ô∏è';
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.animationDuration = (Math.random() * 3 + 3) + 's';
                    document.body.appendChild(heart);
                    setTimeout(() => heart.remove(), 6000);
                }, i * 200);
            }
        }

        function replayExperience() {
            location.reload();
        }

        // Add floating particles in background
        setInterval(() => {
            if (!document.getElementById('receiverView').classList.contains('hidden')) {
                const particle = document.createElement('div');
                particle.className = 'absolute w-2 h-2 bg-white/20 rounded-full pointer-events-none';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = '100%';
                particle.style.animation = 'float-up 10s linear forwards';
                document.getElementById('particles').appendChild(particle);
                setTimeout(() => particle.remove(), 10000);
            }
        }, 500);
    </script>
</body>

</html>